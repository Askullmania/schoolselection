%h1.bold= @school.name

- if @school.eligibility =~ /Walk Zone/
  %div.bold.large.center.green-background
    This school is in your Walk Zone and qualifies for priority selection status

%table
  %tr
    %td.align-top{:width=>'300'}
      %p
        = static_school_map(290, 230)

      - if @school.hours.present?
        %p
          %strong
            Hours:&nbsp;
          = @school.hours

      - if @school.address.present?
        = @school.address 
        %br/
        == #{@school.city.try(:name)} MA, #{@school.zipcode}
        %br/
      - if @school.phone.present?
        %strong
          Phone:&nbsp;
        = @school.phone
        %br/
      - if @school.fax.present?
        %strong
          Fax:&nbsp;
        = @school.fax
        %br/
      - if @school.website.present?
        %br/
        = link_to "School Website", @school.website
    
    %td.align-top
      %h3.gray-background Transportation
      %table.small-bottom-margin
        %thead
          %tr
            %th Transportation Eligibility
            %th Distance
            - if @school.eligibility =~ /Walk Zone/
              %th Walk Time
            %th Drive Time
        %tbody
          %tr
            %td.large
              - if @grade_level.name == "High"
                =raw @school.eligibility =~ /Walk Zone/ ? "#{image_tag('walking.png', :class=> 'transportation-icon')}&nbsp;Walking" : "#{image_tag('city-bus.png', :class=> 'transportation-icon')}&nbsp;MBTA"
              - else
                =raw @school.eligibility =~ /Walk Zone/ ? "#{image_tag('walking.png', :class=> 'transportation-icon')}&nbsp;Walking" : "#{image_tag('school-bus.png', :class=> 'transportation-icon')}&nbsp;School Bus"
            %td.large
              =raw @school.distance.present? ? "#{distance_in_miles_from_meters(@school.distance)} <span class='small'>mi</span>" : '&nbsp;'
            - if @school.eligibility =~ /Walk Zone/
              %td.large
                =raw @school.distance.present? ? "#{walk_time(@school.distance)} <span class='small'>min</span>" : '&nbsp;'
              - else
                &nbsp;
            %td.large
              =raw @school.distance.present? ? "#{drive_time(@school.distance)} <span class='small'>min</span>" : '&nbsp;'

      %h3.gray-background Academics
      %table.small-bottom-margin
        %thead
          %tr
            %th Teachers
            %th Students
            %th Staff : Student Ratio
        %tr
          %td.large
            =raw @school.teachers_count.present? ? @school.teachers_count : '&nbsp;'
          %td.large
            =raw @school.students_count.present? ? @school.students_count : '&nbsp;'
          %td.large
            =raw @school.staff_to_student_ratio.present? ? @school.staff_to_student_ratio : '&nbsp;'
      
      - if @school.grade(session[:grade_level]).try(:open_seats).try(:present?)
        %h3.gray-background 
          Admissions (2010 data)
        %table.no-bottom-margin
          %thead
            %tr
              %th Open Seats
              %th 1st Choices
              %th 2nd Choices
              %th 3rd Choices
          %tr
            - grade = @school.grade(session[:grade_level])
            %td.large
              =raw grade.try(:open_seats) ? grade.open_seats : '&nbsp;'
            %td.large
              =raw grade.try(:first_choice) ? grade.first_choice : '&nbsp;'
            %td.large
              =raw grade.try(:second_choice) ? grade.second_choice : '&nbsp;'
            %td.large
              =raw grade.try(:third_choice) ? grade.third_choice : '&nbsp;'
              

%div
  - if session[:favorites].try(:include?, @school.id)
    %h3.bold
      = image_tag('icons/delete.png')
      = link_to "Remove from My Picks", unfavorite_school_path(@school.id, address: session[:address], zipcode: session[:zipcode], grade_level: session[:grade_level]), :remote => true, :method => :post
  - else
    %h3.bold
      = image_tag('star.png')
      = link_to "Add to My Picks", favorite_school_path(@school.id, address: session[:address], zipcode: session[:zipcode], grade_level: session[:grade_level]), :remote => true, :method => :post