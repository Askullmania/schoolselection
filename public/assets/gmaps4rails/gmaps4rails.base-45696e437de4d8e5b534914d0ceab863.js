var Gmaps4Rails={map:null,visibleInfoWindow:null,userLocation:null,geolocationFailure:function(){return!1},callback:function(){return!1},customClusterer:function(){return null},infobox:function(){return null},map_options:{id:"gmaps4rails_map",draggable:!0,detect_location:!1,center_on_user:!1,center_latitude:0,center_longitude:0,zoom:1,maxZoom:null,minZoom:null,auto_adjust:!0,auto_zoom:!0,bounds:[]},markers_conf:{title:"",picture:"",width:22,length:32,draggable:!1,do_clustering:!1,randomize:!1,max_random_distance:100,list_container:null,offset:0},markers:[],boundsObject:null,polygons:[],polylines:[],circles:[],markerClusterer:null,markerImages:[],initialize:function(){this.map=Gmaps4Rails.createMap(),(this.map_options.detect_location===!0||this.map_options.center_on_user===!0)&&this.findUserLocation(),this.resetSidebarContent()},findUserLocation:function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){Gmaps4Rails.userLocation=Gmaps4Rails.createLatLng(a.coords.latitude,a.coords.longitude),Gmaps4Rails.map_options.center_on_user===!0&&Gmaps4Rails.centerMapOnUser()},function(){this.geolocationFailure(!0)}):this.geolocationFailure(!1)},create_direction:function(){var a=new google.maps.DirectionsRenderer,b=new google.maps.DirectionsService;a.setMap(this.map),this.direction_conf.display_panel&&a.setPanel(document.getElementById(this.direction_conf.panel_id)),a.setOptions({suppressMarkers:!1,suppressInfoWindows:!1,suppressPolylines:!1});var c={origin:this.direction_conf.origin,destination:this.direction_conf.destination,waypoints:this.direction_conf.waypoints,optimizeWaypoints:this.direction_conf.optimizeWaypoints,unitSystem:google.maps.DirectionsUnitSystem[this.direction_conf.unitSystem],avoidHighways:this.direction_conf.avoidHighways,avoidTolls:this.direction_conf.avoidTolls,region:this.direction_conf.region,travelMode:google.maps.DirectionsTravelMode[this.direction_conf.travelMode],language:"en"};b.route(c,function(b,c){c==google.maps.DirectionsStatus.OK&&a.setDirections(b)})},create_circles:function(){for(var a=0;a<this.circles.length;++a)this.create_circle(this.circles[a])},create_circle:function(a){i===0&&(this.exists(a.strokeColor)&&(this.circles_conf.strokeColor=a.strokeColor),this.exists(a.strokeOpacity)&&(this.circles_conf.strokeOpacity=a.strokeOpacity),this.exists(a.strokeWeight)&&(this.circles_conf.strokeWeight=a.strokeWeight),this.exists(a.fillColor)&&(this.circles_conf.fillColor=a.fillColor),this.exists(a.fillOpacity)&&(this.circles_conf.fillOpacity=a.fillOpacity));if(this.exists(a.lat)&&this.exists(a.lng)){var b=new google.maps.Circle({center:Gmaps4Rails.createLatLng(a.lat,a.lng),strokeColor:a.strokeColor||this.circles_conf.strokeColor,strokeOpacity:a.strokeOpacity||this.circles_conf.strokeOpacity,strokeWeight:a.strokeWeight||this.circles_conf.strokeWeight,fillOpacity:a.fillOpacity||this.circles_conf.fillOpacity,fillColor:a.fillColor||this.circles_conf.fillColor,clickable:a.clickable||this.circles_conf.clickable,zIndex:a.zIndex||this.circles_conf.zIndex,radius:a.radius});a.serviceObject=b,b.setMap(this.map)}},clear_circles:function(){for(var a=0;a<this.circles.length;++a)this.clear_circle(this.circles[a])},clear_circle:function(a){a.serviceObject.setMap(null)},hide_circles:function(){for(var a=0;a<this.circles.length;++a)this.hide_circle(this.circles[a])},hide_circle:function(a){a.serviceObject.setMap(null)},show_circles:function(){for(var a=0;a<this.circles.length;++a)this.show_circle(this.circles[a])},show_circle:function(a){a.serviceObject.setMap(this.map)},create_polygons:function(){for(var a=0;a<this.polygons.length;++a)this.create_polygon(a)},create_polygon:function(a){var b=[],c,d,e,f,g;for(var h=0;h<this.polygons[a].length;++h){var i=Gmaps4Rails.createLatLng(this.polygons[a][h].lat,this.polygons[a][h].lng);b.push(i),h===0&&(c=this.polygons[a][h].strokeColor||this.polygons_conf.strokeColor,d=this.polygons[a][h].strokeOpacity||this.polygons_conf.strokeOpacity,e=this.polygons[a][h].strokeWeight||this.polygons_conf.strokeWeight,f=this.polygons[a][h].fillColor||this.polygons_conf.fillColor,g=this.polygons[a][h].fillOpacity||this.polygons_conf.fillOpacity)}var j=new google.maps.Polygon({paths:b,strokeColor:c,strokeOpacity:d,strokeWeight:e,fillColor:f,fillOpacity:g,clickable:!1});this.polygons[a].serviceObject=j,j.setMap(this.map)},create_polylines:function(){for(var a=0;a<this.polylines.length;++a)this.create_polyline(a)},create_polyline:function(a){var b=[],c,d,e;for(var f=0;f<this.polylines[a].length;++f)if(this.exists(this.polylines[a][f].coded_array)){var g=new google.maps.geometry.encoding.decodePath(this.polylines[a][f].coded_array);for(var h=0;h<g.length;++h)b.push(g[h]),b.push(g[h])}else{f===0&&(c=this.polylines[a][0].strokeColor||this.polylines_conf.strokeColor,d=this.polylines[a][0].strokeOpacity||this.polylines_conf.strokeOpacity,e=this.polylines[a][0].strokeWeight||this.polylines_conf.strokeWeight);if(this.exists(this.polylines[a][f].lat)&&this.exists(this.polylines[a][f].lng)){var i=Gmaps4Rails.createLatLng(this.polylines[a][f].lat,this.polylines[a][f].lng);b.push(i)}}var j=new google.maps.Polyline({path:b,strokeColor:c,strokeOpacity:d,strokeWeight:e,clickable:!1});this.polylines[a].serviceObject=j,j.setMap(this.map)},create_markers:function(){this.markers_conf.offset=0,this.createServiceMarkersFromMarkers(),this.clusterize(),this.adjustMapToBounds()},createServiceMarkersFromMarkers:function(){for(var a=this.markers_conf.offset;a<this.markers.length;++a){var b=this.markers[a].lat,c=this.markers[a].lng;if(this.markers_conf.randomize){var d=Gmaps4Rails.randomize(b,c);b=d[0],c=d[1]}this.markers[a].serviceObject=Gmaps4Rails.createMarker({marker_picture:this.exists(this.markers[a].picture)?this.markers[a].picture:this.markers_conf.picture,marker_width:this.exists(this.markers[a].width)?this.markers[a].width:this.markers_conf.width,marker_height:this.exists(this.markers[a].height)?this.markers[a].height:this.markers_conf.length,marker_title:this.exists(this.markers[a].title)?this.markers[a].title:null,marker_anchor:this.exists(this.markers[a].marker_anchor)?this.markers[a].marker_anchor:null,shadow_anchor:this.exists(this.markers[a].shadow_anchor)?this.markers[a].shadow_anchor:null,shadow_picture:this.exists(this.markers[a].shadow_picture)?this.markers[a].shadow_picture:null,shadow_width:this.exists(this.markers[a].shadow_width)?this.markers[a].shadow_width:null,shadow_height:this.exists(this.markers[a].shadow_height)?this.markers[a].shadow_height:null,marker_draggable:this.exists(this.markers[a].draggable)?this.markers[a].draggable:this.markers_conf.draggable,Lat:b,Lng:c,index:a}),this.createInfoWindow(this.markers[a]),this.createSidebar(this.markers[a])}this.markers_conf.offset=this.markers.length},createImageAnchorPosition:function(a){return a===null?null:Gmaps4Rails.createPoint(a[0],a[1])},replaceMarkers:function(a){this.clearMarkers(),this.markers=[],this.boundsObject=Gmaps4Rails.createLatLngBounds(),this.resetSidebarContent(),this.addMarkers(a)},addMarkers:function(a){this.markers=this.markers.concat(a),this.create_markers()},createSidebar:function(a){if(this.markers_conf.list_container){var b=document.getElementById(this.markers_conf.list_container),c=document.createElement("li"),d=document.createElement("a");d.href="javascript:void(0);";var e=this.exists(a.sidebar)?a.sidebar:"Marker";d.innerHTML=e,d.onclick=this.sidebar_element_handler(a.serviceObject,"click"),c.appendChild(d),b.appendChild(c)}},sidebar_element_handler:function(a,b){return function(){Gmaps4Rails.map.panTo(a.position),google.maps.event.trigger(a,b)}},resetSidebarContent:function(){if(this.markers_conf.list_container!==null){var a=document.getElementById(this.markers_conf.list_container);a.innerHTML=""}},adjustMapToBounds:function(a){if(this.map_options.auto_adjust||this.map_options.bounds!==null)this.boundsObject=Gmaps4Rails.createLatLngBounds();if(this.map_options.auto_adjust){Gmaps4Rails.extendBoundsWithMarkers();for(var b=0;b<this.polylines.length;++b)this.polylines[b].serviceObject.latLngs.forEach(function(a){a.forEach(function(a){Gmaps4Rails.boundsObject.extend(a)})});for(var b=0;b<this.polygons.length;++b)this.polygons[b].serviceObject.latLngs.forEach(function(a){a.forEach(function(a){Gmaps4Rails.boundsObject.extend(a)})});for(var b=0;b<this.circles.length;++b)this.boundsObject.extend(this.circles[b].serviceObject.getBounds().getNorthEast()),this.boundsObject.extend(this.circles[b].serviceObject.getBounds().getSouthWest())}for(var b=0;b<this.map_options.bounds.length;++b){var c=Gmaps4Rails.createLatLng(this.map_options.bounds[b].lat,this.map_options.bounds[b].lng);this.boundsObject.extend(c)}if(this.map_options.auto_adjust||this.map_options.bounds.length>0)if(!this.map_options.auto_zoom){var d=this.boundsObject.getCenter();this.map_options.center_latitude=d.lat(),this.map_options.center_longitude=d.lng(),this.map.setCenter(d)}else Gmaps4Rails.fitBounds()},exists:function(a){return a!==""&&typeof a!="undefined"},randomize:function(a,b){var c=this.markers_conf.max_random_distance*this.random(),d=this.markers_conf.max_random_distance*this.random(),e=parseFloat(a)+180/Math.PI*(d/6378137),f=parseFloat(b)+90/Math.PI*(c/6378137)/Math.cos(a);return[e,f]},random:function(){return Math.random()*2-1}}